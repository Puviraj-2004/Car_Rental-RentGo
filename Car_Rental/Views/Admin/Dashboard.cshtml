@model dynamic
@{
    ViewData["Title"] = "Dashboard";
    Layout = "_AdminLayout";
}

@section Styles {
    <style>
        /* KPI கார்டு ஸ்டைல்கள் */
        .stat-card {
            position: relative;
            border: none;
            border-radius: 1rem;
            color: #fff;
            overflow: hidden;
            padding: 2rem;
            transition: transform 0.3s ease;
        }

            .stat-card:hover {
                transform: translateY(-8px);
            }

            .stat-card .stat-icon {
                position: absolute;
                top: 50%;
                right: -20px;
                transform: translateY(-50%);
                font-size: 6rem;
                opacity: 0.2;
            }

            .stat-card .stat-title {
                font-size: 1rem;
                font-weight: 500;
                opacity: 0.9;
            }

            .stat-card .stat-value {
                font-size: 2.75rem;
                font-weight: 700;
                line-height: 1.2;
            }

        .bg-gradient-primary {
            background: linear-gradient(45deg, #3a61ed, #6a82fb);
        }

        .bg-gradient-success {
            background: linear-gradient(45deg, #198754, #28a745);
        }

        .bg-gradient-warning {
            background: linear-gradient(45deg, #ffc107, #ffda6a);
        }

        .bg-gradient-danger {
            background: linear-gradient(45deg, #dc3545, #fd5c6c);
        }

        /* Insight Card Styles */
        .insight-card .card-body {
            text-align: center;
        }

        .insight-card .insight-title {
            font-size: 0.9rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .insight-card .insight-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #343a40;
        }

        .insight-card .insight-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
    </style>
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">Dashboard Overview</h1>
    </div>

    @if (Model.MustChangePassword) { /* ... alert code ... */ }

    <!-- KPI கார்டுகள் -->
    <div class="row g-4">
        <div class="col-xl-3 col-md-6"><div class="stat-card bg-gradient-success"><div class="stat-title">TOTAL REVENUE</div><div class="stat-value">@Model.TotalRevenue.ToString("C")</div><i class="fas fa-dollar-sign stat-icon"></i></div></div>
        <div class="col-xl-3 col-md-6"><div class="stat-card bg-gradient-primary"><div class="stat-title">ACTIVE CUSTOMERS</div><div class="stat-value">@Model.ActiveCustomers</div><i class="fas fa-users stat-icon"></i></div></div>
        <div class="col-xl-3 col-md-6"><div class="stat-card bg-gradient-warning text-dark"><div class="stat-title">TOTAL FLEET</div><div class="stat-value">@Model.TotalCars</div><i class="fas fa-car stat-icon"></i></div></div>
        <div class="col-xl-3 col-md-6"><div class="stat-card bg-gradient-danger"><div class="stat-title">TOTAL BOOKINGS</div><div class="stat-value">@Model.TotalBookings</div><i class="fas fa-calendar-check stat-icon"></i></div></div>
    </div>

    <!-- Insight Cards -->
    <div class="row g-4 mt-2">
        <div class="col-lg-4 col-md-6"><div class="card insight-card h-100"><div class="card-body"><div class="insight-icon text-info"><i class="fas fa-chart-line"></i></div><div class="insight-title">THIS MONTH'S REVENUE</div><div class="insight-value">@Model.CurrentMonthRevenue.ToString("C")</div></div></div></div>
        <div class="col-lg-4 col-md-6"><div class="card insight-card h-100"><div class="card-body"><div class="insight-icon text-primary"><i class="fas fa-trophy"></i></div><div class="insight-title">MOST BOOKED VEHICLE</div><div class="insight-value">@Model.MostBookedVehicle</div></div></div></div>
        <div class="col-lg-4 col-md-6"><div class="card insight-card h-100"><div class="card-body"><div class="insight-icon text-warning"><i class="fas fa-star"></i></div><div class="insight-title">TOP RATED VEHICLE</div><div class="insight-value">@Model.MostRatedVehicle</div></div></div></div>
    </div>

    <!-- Charts Section -->
    <div class="row mt-5 g-4">
        <div class="col-lg-12"><div class="card h-100 p-3"><h5 class="mb-3">Monthly Revenue Trends (Last 12 Months)</h5><canvas id="revenueChart"></canvas></div></div>
        <div class="col-lg-7 mt-4"><div class="card h-100 p-3"><h5 class="mb-3">Booking Trends (Last 12 Months)</h5><canvas id="bookingsChart"></canvas></div></div>
        <div class="col-lg-5 mt-4"><div class="card h-100 p-3"><h5 class="mb-3">Fleet Status</h5><canvas id="fleetStatusChart"></canvas></div></div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            Chart.defaults.font.family = "'Poppins', sans-serif";

            // 1. Revenue Bar Chart - AJAX மூலம்
            fetch('/Admin/GetRevenueTrends')
                .then(response => response.json()).then(result => {
                    const ctxBar = document.getElementById('revenueChart').getContext('2d');
                    new Chart(ctxBar, { type: 'bar', data: { labels: result.labels, datasets: [{ label: 'Monthly Revenue', data: result.data, backgroundColor: 'rgba(25, 135, 84, 0.7)', borderColor: 'rgba(25, 135, 84, 1)', borderWidth: 1 }] } });
                }).catch(error => console.error('Error fetching revenue data:', error));

            // 2. Bookings Line Chart - AJAX மூலம்
            fetch('/Admin/GetBookingTrends')
                .then(response => response.json()).then(result => {
                    const ctxLine = document.getElementById('bookingsChart').getContext('2d');
                    new Chart(ctxLine, { type: 'line', data: { labels: result.labels, datasets: [{ label: 'Bookings', data: result.data, borderColor: 'rgba(13, 110, 253, 1)', backgroundColor: 'rgba(13, 110, 253, 0.1)', fill: true, tension: 0.4 }] } });
                }).catch(error => console.error('Error fetching booking data:', error));

            // 3. Fleet Status Doughnut Chart - Model-லிருந்து நேரடியாக
            const available = @(Model.AvailableCars ?? 0), booked = @(Model.BookedCars ?? 0), maintenance = @(Model.MaintenanceCars ?? 0), notAvailable = @(Model.NotAvailableCars ?? 0);
            const ctxDoughnut = document.getElementById('fleetStatusChart').getContext('2d');
            new Chart(ctxDoughnut, {
                type: 'doughnut',
                data: {
                    labels: ['Available', 'Booked / On-Rent', 'Under Maintenance', 'Not Available'],
                    datasets: [{ data: [available, booked, maintenance, notAvailable], backgroundColor: ['rgba(25, 135, 84, 0.9)', 'rgba(220, 53, 69, 0.9)', 'rgba(255, 193, 7, 0.9)', 'rgba(108, 117, 125, 0.9)'], borderColor: ['#ffffff'], borderWidth: 2 }]
                },
                options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
            });
        });
    </script>
}